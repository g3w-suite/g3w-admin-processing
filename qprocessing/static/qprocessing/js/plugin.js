!function(){var e=window&&window.initConfig&&window.initConfig.group&&window.initConfig.group.plugins;e&&(e.qprocessing=Object.assign(e.qprocessing||{},{version:"3.8.0-alpha.0",hash:"385f9d0",branch:"dev"}))}(),function a(r,n,i){function o(t,e){if(!n[t]){if(!r[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}s=n[t]={exports:{}},r[t][0].call(s.exports,function(e){return o(r[t][1][e]||e)},s,s.exports,a,r,n,i)}return n[t].exports}for(var l="function"==typeof require&&require,e=0;e<i.length;e++)o(i[e]);return o}({1:[function(e,t,s){var a=s.cache={};function r(){}s.insert=function(e){if(a[e])return r;a[e]=!0;var t=document.createElement("style");return t.setAttribute("type","text/css"),"textContent"in t?t.textContent=e:t.styleSheet.cssText=e,document.getElementsByTagName("head")[0].appendChild(t),function(){document.getElementsByTagName("head")[0].removeChild(t),a[e]=!1}}},{}],2:[function(e,t,s){function a(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}Object.defineProperty(s,"__esModule",{value:!0}),r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var s=t,a=[],r=!0,t=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done)&&(a.push(i.value),!s||a.length!==s);r=!0);}catch(e){t=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(t)throw n}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance")},e=e("../service"),n=(e=e)&&e.__esModule?e:{default:e},i=g3wsdk.gui.GUI,o=g3wsdk.core.i18n.tPlugin,l={point:"Point",line:"LineString",polygon:"Polygon"},s.default={name:"DrawInputVectorFeatures",props:{datatypes:{type:Array,default:[]},upload:{type:Boolean}},data:function(){return{toggled:!1,drawTool:{loading:this.upload,disabled:!0}}},methods:{changeDrawType:function(e){this.setDrawInteraction(e)},setDrawInteraction:function(){var e=this,t=(0<arguments.length&&void 0!==arguments[0]?arguments:this.drawGeometryTypes)[0];i.getService("map").disableClickMapControls(!0),this.drawLayer.getSource().clear(),i.getService("map").getMap().removeInteraction(this.drawInteraction),this.drawInteraction=new ol.interaction.Draw({type:t,source:this.drawLayer.getSource()}),this.drawInteraction.on("drawend",function(){return e.drawTool.disabled=!1}),i.getService("map").getMap().addInteraction(this.drawInteraction)},clear:function(){this.drawLayer.getSource().clear(),i.getService("map").disableClickMapControls(!1),i.getService("map").getMap().removeInteraction(this.drawInteraction),i.closeUserMessage()}},watch:{toggled:function(e){var t,s=this;e?(this.setDrawInteraction(),i.showUserMessage({title:"",type:"tool",size:"small",closable:!1,hooks:{body:{template:'\n                <div style="width: 100%; padding: 5px;" v-disabled="state.loading">\n                \x3c!-- NB: it makes use of built-in g3w-client directive: "v-select2" --\x3e\n                <select\n                  v-select2 = "\'type\'"\n                  :search   = "false"\n                  ref       = "select"\n                  style     = "width: 100%">\n                  <option\n                    v-for      = "type in types"\n                    :key       = "type"\n                    :value     = "type"\n                    v-t-plugin = "\'qprocessing.draw_types.\'+type"\n                  ></option>\n                </select>\n\n                <bar-loader :loading="state.loading"/>\n\n                <button\n                  v-disabled="state.disabled"\n                  class="btn skin-background-color"\n                  @click.stop.prevent="uploadLayer(type)"\n                  style="margin: 3px; width: 100%">\n                  <i :class="[g3wtemplate.getFontClass(\'cloud-upload\')]"></i>\n                </button>\n\n                </div>',data:function(){return{state:s.drawTool,types:s.drawGeometryTypes,type:s.drawGeometryTypes[0]}},watch:{type:function(e){s.changeDrawType(e)}},methods:{uploadLayer:(t=a(function*(e){var t=s.drawLayer.getSource().getFeatures(),e=(yield s.$nextTick(),n.default.createGeoJSONFileFromOLFeatures({features:t,name:o("qprocessing.draw_filename")+"("+o("qprocessing.draw_types."+e)+")"}));s.$emit("add-layer",{file:e,features:t,type:"draw"})}),function(e){return t.apply(this,arguments)})}}}})):this.clear(),this.$emit("toggled-tool",!e)},upload:function(e){this.drawTool.loading=e,this.drawTool.disabled=!e,e||(this.clear(),this.toggled=e)}},created:function(){var a=this;this.drawGeometryTypes=Object.entries(l).reduce(function(e,t){var t=r(t,2),s=t[0],t=t[1];return(a.datatypes.find(function(e){return"anygeometry"===e})||a.datatypes.find(function(e){return e===s}))&&e.push(t),e},[]),this.drawInteraction=null,this.drawLayer=new ol.layer.Vector({source:new ol.source.Vector}),i.getService("map").getMap().addLayer(this.drawLayer)},beforeDestroy:function(){this.clear(),i.getService("map").getMap().removeLayer(this.drawLayer),this.drawLayer=null,this.drawInteraction=null}},t.exports.__esModule&&(t.exports=t.exports.default);var r,n,i,o,l,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticClass:"qprocessing-draw-vector-features",staticStyle:{"font-size":"1.3em"}},[e("button",{staticClass:"btn skin-background-color",staticStyle:{height:"100%","margin-right":"0 !important"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.toggled=!t.toggled}}},[e("i",{class:[t.g3wtemplate.getFontClass("pencil")]})])])},e.staticRenderFns=[],e._scopeId="data-v-508c737b"},{"../service":28}],3:[function(e,t,s){var a,r,n;e("vueify/lib/insert-css").insert("//Replicate same scoped style in InputBase.vue label[data-v-6b20b160]{text-align:left!important;padding-top:0!important;margin-bottom:3px}");function i(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}Object.defineProperty(s,"__esModule",{value:!0}),e=e("../service"),a=(e=e)&&e.__esModule?e:{default:e},e=g3wsdk.gui.vue.Mixins.selectMixin,s.default={name:"InputFieldChooser",mixins:[e],props:{state:{type:Object,required:!0}},data:function(){return{loading:!1,value:this.state.input.options.multiple?[]:null}},computed:{notvalid:function(){return!1===this.state.validate.valid}},watch:{value:function(e){this.state.input.options.multiple?(this.state.value=e.join(","),!0===this.state.validate.required&&(this.state.validate.valid=0<e.length)):(this.state.value=e,!0===this.state.validate.required&&(this.state.validate.valid=""!==e&&null!==e)),this.$emit("changeinput",this.state)}},methods:{getFieldsFromLayer:(n=i(function*(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=(this.loading=!0,yield a.default.getFieldsFromLayer(e,t));return this.loading=!1,t}),function(e){return n.apply(this,arguments)}),changeSelectedFeaturesEventHandler:function(){this.setInputValueFromSelectedFeatures(this.selected_features_checked)}},created:function(){this.state.validate.valid=!0},mounted:(r=i(function*(){var t,s=this;this.state.validate.required&&(this.state.validate.message="qprocessing.inputs.fieldchooser.validate.message."+(this.state.input.options.multiple?"multiple":"single")),yield this.$nextTick(),this.select2=$(this.$refs.select),this.$emit("register-change-input",{inputName:this.state.input.options.parent_field,handler:(t=i(function*(e){e=e.split(":")[0],s.state.input.options.values=yield s.getFieldsFromLayer(e,{datatype:s.state.input.options.datatype}),s.state.input.options.multiple?s.value=s.state.input.options.default_to_all_fields?s.state.input.options.values.map(function(e){return e.value}):[]:s.value=null,(null===s.value||Array.isArray(s.value)&&0===s.value.length)&&s.select2.val(null).trigger("change")}),function(e){return t.apply(this,arguments)})}),this.state.validate.valid=!this.state.validate.required,this.$emit("addinput",this.state)}),function(){return r.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.state.visible?s("div",{staticClass:"form-group"},[t._t("label",[s("label",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.state.editable,expression:"!state.editable"}],staticClass:"col-sm-12",attrs:{for:t.state.name}},[t._v(t._s(t.state.label)+"\n      "),t.state.validate&&t.state.validate.required?s("span",[t._v("*")]):t._e()])]),t._v(" "),s("div",{staticClass:"col-sm-12"},[t._t("body",[s("bar-loader",{attrs:{loading:t.loading}}),t._v(" "),s("select",{directives:[{name:"select2",rawName:"v-select2",value:"value",expression:"'value'"}],ref:"select",staticClass:"form-control",staticStyle:{width:"100%"},attrs:{multiple:t.state.input.options.multiple,id:t.state.name}},[t.state.validate.required&&!t.state.input.options.multiple?s("option",{domProps:{value:null}},[t._v("---")]):t._e(),t._v(" "),t._l(t.state.input.options.values,function(e){return s("option",{key:e.value,domProps:{selected:t.state.input.options.default_to_all_fields,value:e.value}},[t._v(t._s(e.key)+"\n        ")])})],2)]),t._v(" "),t._t("message",[t.notvalid?s("p",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:t.state.validate.message,expression:"state.validate.message"}],staticClass:"g3w-long-text error-input-message",staticStyle:{margin:"0"}}):t.state.info?s("p",{staticStyle:{margin:"0"},domProps:{innerHTML:t._s(t.state.info)}}):t._e()]),t._v(" "),t.state.help&&this.state.help.visible?s("div",{staticClass:"g3w_input_help skin-background-color extralighten",domProps:{innerHTML:t._s(t.state.help.message)}}):t._e()],2)],2):t._e()},s.staticRenderFns=[],s._scopeId="data-v-6b20b160"},{"../service":28,"vueify/lib/insert-css":1}],4:[function(e,t,s){var a,r;e("vueify/lib/insert-css").insert("//Replicate same scoped style in InputBase.vue label[data-v-060b314b]{text-align:left!important;padding-top:0!important;margin-bottom:3px}");function n(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}Object.defineProperty(s,"__esModule",{value:!0}),e=e("../service"),a=(e=e)&&e.__esModule?e:{default:e},e=g3wsdk.gui.vue.Mixins.selectMixin,s.default={name:"InputPrjRasterLayer",mixins:[e],props:{state:{type:Object,required:!0}},data:function(){return{value:null}},computed:{notvalid:function(){return!1===this.state.validate.valid}},watch:{value:function(e){this.state.value=e,this.$emit("changeinput",this.state)}},methods:{},created:function(){this.state.input.options.values=a.default.getInputPrjRasterLayerData(),0<this.state.input.options.values.length&&(this.value=this.state.input.options.values[0].value,this.state.validate.valid=!0)},mounted:(r=n(function*(){yield this.$nextTick(),this.select2=$(this.$refs.select),this.$emit("addinput",this.state)}),function(){return r.apply(this,arguments)}),beforeDestroy:function(){}},t.exports.__esModule&&(t.exports=t.exports.default);s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.state.visible?s("div",{staticClass:"form-group"},[t._t("label",[s("label",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.state.editable,expression:"!state.editable"}],staticClass:"col-sm-12",attrs:{for:t.state.name}},[t._v(t._s(t.state.label)+"\n\n      "),t.state.validate&&t.state.validate.required?s("span",[t._v("*\n      ")]):t._e()])]),t._v(" "),s("div",{staticClass:"col-sm-12"},[t._t("body",[s("select",{directives:[{name:"select2",rawName:"v-select2",value:"value",expression:"'value'"}],ref:"select",staticClass:"form-control",staticStyle:{width:"100%"},attrs:{id:t.state.name}},t._l(t.state.input.options.values,function(e){return s("option",{key:e.value,domProps:{value:e.value}},[t._v(t._s(e.key)+"\n        ")])}),0)]),t._v(" "),t._t("message",[t.notvalid?s("p",{staticClass:"g3w-long-text error-input-message",staticStyle:{margin:"0"},domProps:{innerHTML:t._s(t.state.validate.message)}}):t.state.info?s("p",{staticStyle:{margin:"0"},domProps:{innerHTML:t._s(t.state.info)}}):t._e()]),t._v(" "),t.state.help&&this.state.help.visible?s("div",{staticClass:"g3w_input_help skin-background-color extralighten",domProps:{innerHTML:t._s(t.state.help.message)}}):t._e()],2)],2):t._e()},s.staticRenderFns=[],s._scopeId="data-v-060b314b"},{"../service":28,"vueify/lib/insert-css":1}],5:[function(e,t,s){var a,r,n,i,o,l,u;e("vueify/lib/insert-css").insert("//Replicate same scoped style in InputBase.vue label[data-v-44a2d776]{text-align:left!important;padding-top:0!important;margin-bottom:3px}.vector-tools-context[data-v-44a2d776]{margin-bottom:5px}.vector-tools[data-v-44a2d776]{display:flex;justify-content:space-between}.vector-tools-message[data-v-44a2d776]{margin:3px}.vector-tools-message .error-upload[data-v-44a2d776]{font-weight:700;color:red}");function c(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}Object.defineProperty(s,"__esModule",{value:!0}),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=c(e("./UploadVectorFile.vue")),n=c(e("./DrawInputVectorFeatures.vue")),i=c(e("../service")),u=g3wsdk.gui.GUI,e=g3wsdk.gui.vue.Mixins.selectMixin,s.default={name:"InputPrjVectorLayer",mixins:[e],components:{UploadVectorFile:r.default,DrawInputVectorFeatures:n.default},props:{modelId:{type:Number,required:!0},state:{type:Object,required:!0}},data:function(){return{upload:!1,errorUpload:!1,value:null,selected_features_checked:!1,selected_features_disabled:!0}},computed:{showUploadFile:function(){return!!this.state.input.options.datatypes.find(function(e){return"anygeometry"===e||-1!==["point","line","polygon"].indexOf(e)})},isSelectedFeatures:function(){return"prjvectorlayerfeature"===this.state.input.type},notvalid:function(){return!1===this.state.validate.valid}},methods:{isValid:function(e){return e!==a("undefined")&&null!==e},showAddTempLayer:function(e){this.addTempLayer.setVisible(e)},addLayer:(l=d(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.file,e=e.features,e=void 0===e?[]:e;this.upload=!0,this.errorUpload=!1;try{var s=yield i.default.uploadFile({file:t,inputName:this.state.name,modelId:this.modelId}),a=s.key,r=s.value;this.state.input.options.values=this.state.input.options.values.filter(function(e){e.key;return!e.value.startsWith("file:")}),this.addTempLayer.getSource().clear(),this.addTempLayer.getSource().addFeatures(e),this.addTempLayer.setVisible(!0),this.state.input.options.values.push({key:a,value:r}),yield this.$nextTick(),this.value=r,$(this.$refs.select_layer).select2().val(r).trigger("change")}catch(e){this.errorUpload=!0}this.upload=!1}),function(){return l.apply(this,arguments)}),setDisabledSelectFeaturesCheckbox:function(e){this.selected_features_disabled=0===i.default.getLayerSelectedFeaturesIds(e).length,!0===this.selected_features_disabled&&(this.selected_features_checked=!1)},setInputValueFromSelectedFeatures:function(e){var t=i.default.getLayerSelectedFeaturesIds(this.value);!0===e&&0<t.length?this.state.value=this.value+":"+t.join(","):this.state.value=this.value,this.$emit("changeinput",this.state)},changeSelectedFeaturesEventHandler:function(){this.setDisabledSelectFeaturesCheckbox(this.value),this.setInputValueFromSelectedFeatures(this.selected_features_checked)}},watch:{value:function(e){!0===this.isSelectedFeatures&&this.setDisabledSelectFeaturesCheckbox(e),this.state.value=e,this.state.validate.valid=this.isValid(e),this.$emit("changeinput",this.state)},selected_features_checked:function(e){this.setInputValueFromSelectedFeatures(e)}},created:function(){var t=this;this.state.input.options.values=i.default.getInputPrjVectorLayerData(this.state.input.options.datatypes),0<this.state.input.options.values.length&&(this.value=this.state.input.options.values[0].value,this.state.validate.valid=!0),null!==this.value&&this.isSelectedFeatures&&(this.selected_features_id=[],i.default.registersSelectedFeatureLayersEvent(),i.default.on("change-selected-features",this.changeSelectedFeaturesEventHandler.bind(this))),this.addTempLayer=new ol.layer.Vector({source:new ol.source.Vector}),u.getService("map").getMap().addLayer(this.addTempLayer),this.addTempLayer.setVisible(!1),this.keyAddExternal=i.default.registerAddExternalLayer({type:"vector",handler:function(e){i.default.isExternalLayerValidForInputDatatypes({layer:e,datatypes:t.state.input.options.datatypes})&&t.state.input.options.values.push(i.default.externalVectorLayerToInputPrjVectorLayerValue(e))}})},mounted:(o=d(function*(){yield this.$nextTick(),this.select2=$(this.$refs.select_layer),this.$emit("addinput",this.state),this.$emit("changeinput",this.state)}),function(){return o.apply(this,arguments)}),beforeDestroy:function(){this.isSelectedFeatures&&(i.default.unregistersSelectedFeatureLayersEvent(),i.default.removeAllListeners("change-selected-features")),this.addTempLayer.getSource().clear(),u.getService("map").getMap().removeLayer(this.addTempLayer),this.addTempLayer=null,i.default.unregisterAddExternalLayer(this.keyAddExternal)}},t.exports.__esModule&&(t.exports=t.exports.default);s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var r=this,e=r.$createElement,t=r._self._c||e;return r.state.visible?t("div",{staticClass:"form-group"},[r._t("label",[t("label",{directives:[{name:"disabled",rawName:"v-disabled",value:!r.state.editable,expression:"!state.editable"}],staticClass:"col-sm-12",attrs:{for:r.state.name}},[r._v(r._s(r.state.label)+"\n      "),r.state.validate&&r.state.validate.required?t("span",[r._v("*")]):r._e()])]),r._v(" "),t("div",{staticClass:"col-sm-12"},[r.showUploadFile?t("section",{directives:[{name:"disabled",rawName:"v-disabled",value:r.upload,expression:"upload"}],staticClass:"vector-tools-context"},[t("section",{staticClass:"vector-tools"},[t("upload-vector-file",{attrs:{upload:r.upload},on:{"add-layer":r.addLayer}}),r._v(" "),t("draw-input-vector-features",{attrs:{upload:r.upload,datatypes:r.state.input.options.datatypes},on:{"toggled-tool":r.showAddTempLayer,"add-layer":r.addLayer}})],1),r._v(" "),t("section",{staticClass:"vector-tools-message"},[r.errorUpload?t("div",{staticClass:"error-upload"},[r._v(" Errore ")]):r._e()])]):r._e(),r._v(" "),r._t("body",[t("select",{directives:[{name:"select2",rawName:"v-select2",value:"value",expression:"'value'"}],ref:"select_layer",staticClass:"form-control",staticStyle:{width:"100%"},attrs:{id:r.state.name}},r._l(r.state.input.options.values,function(e){return t("option",{key:e.value,domProps:{value:e.value}},[r._v(r._s(e.key)+"\n        ")])}),0),r._v(" "),r.isSelectedFeatures?t("div",{directives:[{name:"disabled",rawName:"v-disabled",value:r.selected_features_disabled,expression:"selected_features_disabled"}],staticClass:"prjvectorlayerfeature-only-selected-features"},[t("input",{directives:[{name:"model",rawName:"v-model",value:r.selected_features_checked,expression:"selected_features_checked"}],staticClass:"magic-checkbox",staticStyle:{width:"100%"},attrs:{type:"checkbox",id:r.state.name+"_checkbox"},domProps:{checked:Array.isArray(r.selected_features_checked)?-1<r._i(r.selected_features_checked,null):r.selected_features_checked},on:{change:function(e){var t,s=r.selected_features_checked,e=e.target,a=!!e.checked;Array.isArray(s)?(t=r._i(s,null),e.checked?t<0&&(r.selected_features_checked=s.concat([null])):-1<t&&(r.selected_features_checked=s.slice(0,t).concat(s.slice(t+1)))):r.selected_features_checked=a}}}),r._v(" "),t("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"qprocessing.inputs.prjvectorlayerfeature.selected_features",expression:"'qprocessing.inputs.prjvectorlayerfeature.selected_features'"}],staticStyle:{"margin-top":"10px"},attrs:{for:r.state.name+"_checkbox"}})]):r._e()]),r._v(" "),r._t("message",[r.notvalid?t("p",{staticClass:"g3w-long-text error-input-message",staticStyle:{margin:"0"},domProps:{innerHTML:r._s(r.state.validate.message)}}):r.state.info?t("p",{staticStyle:{margin:"0"},domProps:{innerHTML:r._s(r.state.info)}}):r._e()]),r._v(" "),r.state.help&&this.state.help.visible?t("div",{staticClass:"g3w_input_help skin-background-color extralighten",domProps:{innerHTML:r._s(r.state.help.message)}}):r._e()],2)],2):r._e()},s.staticRenderFns=[],s._scopeId="data-v-44a2d776"},{"../service":28,"./DrawInputVectorFeatures.vue":2,"./UploadVectorFile.vue":12,"vueify/lib/insert-css":1}],6:[function(e,t,s){var a,r,n,i,o,l,u,c,d;e("vueify/lib/insert-css").insert(".qprocessing-model[data-v-d33db0d4]{padding-bottom:10px}.qprocessing-model-header[data-v-d33db0d4]{font-size:1.3em;font-weight:700}.title[data-v-d33db0d4]{font-weight:700;margin-bottom:5px}.qprocessing-model-results .icon[data-v-d33db0d4]{cursor:pointer;border:2px solid transparent;margin-bottom:8px;padding:3px;border-radius:5px}.qprocessing-model-results .icon.pulse[data-v-d33db0d4]{transform:scale(1);animation:pulse 2s infinite}.qprocess-model-footer button.run[data-v-d33db0d4]{width:100%}.qprocessing-model-inputs[data-v-d33db0d4]{margin-bottom:5px}.qprocessing-model-inputs .g3w-form[data-v-d33db0d4],.qprocessing-model-outputs .g3w-form[data-v-d33db0d4]{background-color:transparent!important}.qprocess-model-footer[data-v-d33db0d4]{margin-top:10px}.qprocess-model-footer .message[data-v-d33db0d4]{font-weight:700}@keyframes pulse{0%{transform:scale(.75)}70%{transform:scale(1)}to{transform:scale(.75)}}");function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}Object.defineProperty(s,"__esModule",{value:!0}),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s,a=arguments[t];for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},r=p(e("../form/inputs")),n=p(e("../form/outputs")),i=p(e("../service")),o=p(e("../modelresults")),g3wsdk.gui.GUI,e=g3wsdk.gui.vue.Mixins.formInputsMixins,s.default={name:"modelPanel",mixins:[e],components:a({},r.default,n.default),props:{model:{required:!0}},data:function(){return{state:{loading:!1,progress:null,message:{type:"success",show:!1}},tovalidate:[],task:null,newResults:!1}},methods:{addResultToModel:function(){var t,e,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=s.output,s=s.result;void 0!==s&&(t=a.name,(e=this.model.results.find(function(e){return e.id===t}))?e.urls.push(s[a.name]):this.model.results.push({id:a.name,label:a.label,urls:[s[a.name]]}),this.newResults=!0)},getMessageColor:function(){switch(this.state.message.type){case"success":return"green";case"error":return"red"}},registerChangeInputEvent:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.inputName,e=e.handler;void 0===this.subscribe_change_input[t]&&(this.subscribe_change_input[t]=[]),this.subscribe_change_input[t].push(e)},_changeInput:(d=f(function*(t){yield this.$nextTick(),Array.isArray(this.subscribe_change_input[t.name])&&this.subscribe_change_input[t.name].forEach(function(e){return e(t.value)}),this.changeInput(t)}),function(e){return d.apply(this,arguments)}),run:(c=f(function*(){this.state.loading=!0,this.state.message.show=!1,yield this.$nextTick();try{this.task=yield i.default.runModel({model:this.model,state:this.state}),this.state.message.type="success"}catch(e){this.state.message.type="error"}this.state.loading=!1,this.state.message.show=!0}),function(){return c.apply(this,arguments)}),showModelResults:function(){new o.default({model:this.model}).show(),this.newResults=!1}},created:function(){this.subscribe_change_input={}},mounted:(u=f(function*(){yield this.$nextTick(),$(".qprocessing-model-inputs input").keypress(function(e){13===e.which&&e.preventDefault()})}),function(){return u.apply(this,arguments)}),beforeDestroy:(l=f(function*(){}),function(){return l.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{staticClass:"qprocessing-model"},[a("section",{staticClass:"qprocessing-model-header"},[a("div",{staticClass:"skin-color"},[s._v(s._s(s.model.display_name.toUpperCase()))])]),s._v(" "),a("section",{staticClass:"qprocessing-model-inputs"},[a("div",{staticClass:"title"},[s._v("INPUTS")]),s._v(" "),a("divider"),s._v(" "),a("form",{staticClass:"form-horizontal g3w-form"},[a("div",{staticClass:"box-primary"},[a("div",{staticClass:"box-body"},s._l(s.model.inputs,function(t){return a(t.input.type+"_input",{key:t.name,tag:"component",attrs:{modelId:s.model.id,state:t},on:{"register-change-input":s.registerChangeInputEvent,addinput:s.addToValidate,changeinput:function(e){return s._changeInput(t)}}})}),1)])])],1),s._v(" "),a("section",{staticClass:"qprocessing-model-outputs"},[a("div",{staticClass:"title"},[s._v("OUTPUTS")]),s._v(" "),a("divider"),s._v(" "),a("form",{staticClass:"form-horizontal g3w-form"},[a("div",{staticClass:"box-primary"},[a("div",{staticClass:"box-body"},s._l(s.model.outputs,function(e){return a(""+e.input.type,{key:e.name,tag:"component",attrs:{state:e,task:s.task},on:{"add-result-to-model-results":s.addResultToModel}})}),1)])])],1),s._v(" "),a("section",{staticClass:"qprocessing-model-results"},[a("section",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[a("div",{staticClass:"title"},[s._v("RESULTS")]),s._v(" "),a("span",{directives:[{name:"disabled",rawName:"v-disabled",value:0===s.model.results.length,expression:"model.results.length === 0"}],staticClass:"icon skin-color skin-border-color",class:[s.g3wtemplate.getFontClass("list"),{pulse:s.newResults}],on:{click:function(e){return e.stopPropagation(),e.preventDefault(),s.showModelResults(e)}}})]),s._v(" "),a("divider")],1),s._v(" "),a("section",{staticClass:"qprocess-model-footer"},[a("div",[s.state.progress?a("progressbar",{attrs:{progress:s.state.progress}}):[a("bar-loader",{attrs:{loading:s.state.loading}})],s._v(" "),a("button",{staticClass:"btn skin-background-color run",attrs:{disabled:!s.valid||s.state.loading},on:{click:function(e){return e.stopPropagation(),s.run(e)}}},[a("i",{class:s.g3wtemplate.font.run})]),s._v(" "),s.state.message.show?a("div",[a("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"qprocessing.run.messages."+s.state.message.type,expression:"`qprocessing.run.messages.${state.message.type}`"}],staticClass:"message",style:{color:s.getMessageColor()}})]):s._e()],2)])])},s.staticRenderFns=[],s._scopeId="data-v-d33db0d4"},{"../form/inputs":22,"../form/outputs":23,"../modelresults":26,"../service":28,"vueify/lib/insert-css":1}],7:[function(e,t,s){e("vueify/lib/insert-css").insert(".result-section-items i[data-v-5836ba08]{padding:3px;cursor:pointer;font-weight:700}");Object.defineProperty(s,"__esModule",{value:!0}),a=g3wsdk.core.utils.downloadFile,s.default={name:"ModelResults",props:{model:{type:Object}},methods:{removeResult:function(e,t){e.urls.splice(t,1)},downloadResult:function(e){a({url:e})}}},t.exports.__esModule&&(t.exports=t.exports.default);var a,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var r=this,e=r.$createElement,n=r._self._c||e;return n("div",{staticClass:"qprocessing-model-results"},r._l(r.model.results,function(a){return a.urls.length?n("div",{key:a.id},[n("h4",{staticStyle:{"font-weight":"bold"}},[r._v(r._s(a.label))]),r._v(" "),n("divider"),r._v(" "),n("ul",{staticClass:"treeview-menu menu-items",staticStyle:{"background-color":"#2c3b41"}},r._l(a.urls,function(t,s){return n("li",{key:t,staticClass:"menu-item",staticStyle:{display:"flex","justify-content":"space-between",padding:"5px"}},[n("span",[r._v(r._s(a.id)+"_"+r._s(s))]),r._v(" "),n("section",{staticClass:"result-section-items"},[n("i",{class:r.g3wtemplate.font.download,on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.downloadResult(t)}}}),r._v(" "),n("i",{class:r.g3wtemplate.font.trash,staticStyle:{color:"red"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.removeResult(a,s)}}})])])}),0)],1):r._e()}),0)},e.staticRenderFns=[],e._scopeId="data-v-5836ba08"},{"vueify/lib/insert-css":1}],8:[function(e,t,s){function a(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}Object.defineProperty(s,"__esModule",{value:!0}),s.default={name:"OutputFile",props:{state:{type:Object,required:!0},task:{required:!0}},data:function(){return this.state.value=this.state.input.options.values[0].value,{type:this.state.value}},methods:{changeSelect:function(e){this.state.value=e}},watch:{type:function(e){this.changeSelect(e)},task:(r=a(function*(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).task_result;this.$emit("add-result-to-model-results",{output:this.state,result:void 0===e?{}:e})}),function(){return r.apply(this,arguments)})}},t.exports.__esModule&&(t.exports=t.exports.default);var r,s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:s.state.description,expression:"state.description",arg:"top",modifiers:{create:!0}}],staticClass:"form-group"},[a("label",{staticClass:"col-sm-12",staticStyle:{color:"#ffffff !important"},attrs:{for:s.state.name}},[s._v(s._s(s.state.label)+"\n  ")]),s._v(" "),a("div",{staticClass:"col-sm-12"},[a("select",{directives:[{name:"select2",rawName:"v-select2",value:"type",expression:"'type'"}],ref:"select2",staticClass:"form-control qprocessing-output-vectorlayer-select",attrs:{id:s.state.name}},s._l(s.state.input.options.values,function(e){var t=e.key,e=e.value;return a("option",{key:t,domProps:{value:e}},[s._v(s._s(t)+"\n      ")])}),0)])])},s.staticRenderFns=[]},{}],9:[function(e,t,s){function a(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}Object.defineProperty(s,"__esModule",{value:!0}),s.default={name:"OutputRasterLayer",props:{state:{type:Object,required:!0},task:{required:!0}},data:function(){return this.state.value=this.state.input.options.values[0].value,{type:this.state.value}},methods:{changeSelect:function(e){this.state.value=e}},watch:{type:function(e){this.changeSelect(e)},task:(r=a(function*(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).task_result,e=(void 0===e?{}:e)[this.state.name];this.$emit("add-result-to-model-results",{url:e})}),function(){return r.apply(this,arguments)})}},t.exports.__esModule&&(t.exports=t.exports.default);var r,s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:s.state.description,expression:"state.description",arg:"top",modifiers:{create:!0}}],staticClass:"form-group"},[a("label",{staticClass:"col-sm-12",staticStyle:{color:"#ffffff !important"},attrs:{for:s.state.name}},[s._v(s._s(s.state.label)+"\n  ")]),s._v(" "),a("div",{staticClass:"col-sm-12"},[a("select",{directives:[{name:"select2",rawName:"v-select2",value:"type",expression:"'type'"}],ref:"select2",staticClass:"form-control qprocessing-output-vectorlayer-select",attrs:{id:s.state.name}},s._l(s.state.input.options.values,function(e){var t=e.key,e=e.value;return a("option",{key:t,domProps:{value:e}},[s._v(s._s(t)+"\n      ")])}),0)])])},s.staticRenderFns=[]},{}],10:[function(e,t,s){function i(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}Object.defineProperty(s,"__esModule",{value:!0}),o=g3wsdk.gui.GUI,r=g3wsdk.core.utils,l=r.uniqueId,u=r.getRandomColor,r=g3wsdk.core.geoutils,c=r.createVectorLayerFromFile,d=r.createStyleFunctionToVectorLayer,s.default={name:"OutputVectorLayer",props:{state:{type:Object,required:!0},task:{required:!0}},data:function(){return this.state.value=this.state.input.options.values[0].value,{checked:!0,type:this.state.value}},methods:{changeSelect:function(e){this.state.value=e}},watch:{type:function(e){this.changeSelect(e)},task:(a=i(function*(){var t,s,a,r=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).task_result,e=void 0===e?{}:e,n=e[this.state.name];this.checked&&(t=void 0,s="shp"!==this.type?this.type:"zip",yield fetch(n).then((a=i(function*(e){try{t=e.headers.get("content-disposition").split("filename=")[1].replace(/"/g,"")}catch(e){t=l()+"_"+r.type}var a=yield e.blob();"csv"!==s&&(e=yield"zip"===s||"kmz"===s?Promise.resolve(a):new Promise(function(t,e){var s=new FileReader;s.addEventListener("load",function(e){t(s.result)},!1),s.readAsText(a)}),(e=yield c({name:t,data:e,crs:o.getService("map").getEpsg(),mapCrs:o.getService("map").getEpsg(),type:s})).setStyle(d({color:u()})),o.getService("map").addExternalLayer(e,{type:s,downloadUrl:n}))}),function(e){return a.apply(this,arguments)}))),this.$emit("add-result-to-model-results",{output:this.state,result:e})}),function(){return a.apply(this,arguments)})}},t.exports.__esModule&&(t.exports=t.exports.default);var a,o,l,u,c,d,r="function"==typeof t.exports?t.exports.options:t.exports;r.render=function(){var r=this,e=r.$createElement,s=r._self._c||e;return s("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:r.state.description,expression:"state.description",arg:"top",modifiers:{create:!0}}],staticClass:"form-group"},[s("label",{staticClass:"col-sm-12",staticStyle:{color:"#ffffff !important"},attrs:{for:r.state.name}},[r._v(r._s(r.state.label)+"\n  ")]),r._v(" "),s("div",{staticClass:"col-sm-12"},[s("select",{directives:[{name:"select2",rawName:"v-select2",value:"type",expression:"'type'"}],ref:"select2",staticClass:"form-control qprocessing-output-vectorlayer-select",attrs:{id:r.state.name}},r._l(r.state.input.options.values,function(e){var t=e.key,e=e.value;return s("option",{key:t,domProps:{value:e}},[r._v(r._s(t)+"\n      ")])}),0),r._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:r.checked,expression:"checked"}],staticClass:"magic-checkbox",staticStyle:{width:"100%"},attrs:{type:"checkbox",id:r.state.name+"_checkbox"},domProps:{checked:Array.isArray(r.checked)?-1<r._i(r.checked,null):r.checked},on:{change:function(e){var t,s=r.checked,e=e.target,a=!!e.checked;Array.isArray(s)?(t=r._i(s,null),e.checked?t<0&&(r.checked=s.concat([null])):-1<t&&(r.checked=s.slice(0,t).concat(s.slice(t+1)))):r.checked=a}}}),r._v(" "),s("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"qprocessing.outputs.outputvector.open_file_on_map",expression:"'qprocessing.outputs.outputvector.open_file_on_map'"}],staticStyle:{"margin-top":"10px"},attrs:{for:r.state.name+"_checkbox"}})])])},r.staticRenderFns=[]},{}],11:[function(e,t,s){var a,r;e("vueify/lib/insert-css").insert("li[data-v-403630b1]{color:#fff;padding:1em}p[data-v-403630b1]{white-space:normal}");function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(s,"__esModule",{value:!0}),a=n(e("../modelpanel")),r=n(e("../service")),s.default={name:"qprocessing-sidebar",data:function(){return{models:r.default.config.models}},methods:{showPanel:function(e){new a.default({model:e}).show()}}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ul",{staticClass:"treeview-menu g3w-search g3w-tools menu-items",attrs:{id:"g3w-client-plugin-qprocessing"}},s._l(s.models,function(t){return a("li",{key:t.id,staticClass:"menu-item",on:{click:function(e){return e.stopPropagation(),s.showPanel(t)}}},[a("i",{class:s.g3wtemplate.getFontClass("tool")}),s._v(" "),a("span",[s._v(s._s(t.display_name))])])}),0)},e.staticRenderFns=[],e._scopeId="data-v-403630b1"},{"../modelpanel":25,"../service":28,"vueify/lib/insert-css":1}],12:[function(e,t,s){e("vueify/lib/insert-css").insert("form.addlayer[data-v-0a80b68a]{position:relative;border:2px dashed;text-align:center;border-radius:3px}.addlayer input[data-v-0a80b68a]{position:absolute;margin:0;padding:0;width:100%;height:100%;outline:0;opacity:0;cursor:pointer;display:block}.drag_and_drop[data-v-0a80b68a]{line-height:20px;padding:5px;color:#fff}");Object.defineProperty(s,"__esModule",{value:!0}),s.default={name:"UploadVectorFile",props:{upload:{type:Boolean}},data:function(){return{layer:{name:null,id:null}}},methods:{updateFile:function(){this.$emit("add-layer",{file:this.$refs.file.files[0],type:"upload"})}},created:function(){this.accept=["zip","geojson","GEOJSON","kml","kmz","KMZ","KML","json","gpx","gml","csv"].map(function(e){return"."+e}).join(",")}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"qprocessing-upload-vector-file",staticStyle:{"flex-grow":"2"}},[t("section",{staticClass:"upload-file-content"},[t("form",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"mapcontrols.add_layer_control.drag_layer",expression:"'mapcontrols.add_layer_control.drag_layer'",arg:"top",modifiers:{create:!0}}],staticClass:"addlayer skin-border-color"},[t("input",{ref:"file",attrs:{type:"file",title:" ",accept:e.accept},on:{change:e.updateFile}}),e._v(" "),t("div",{staticClass:"drag_and_drop"},[t("i",{staticClass:"fa-2x",class:e.g3wtemplate.getFontClass("cloud-upload"),attrs:{"aria-hidden":"true"}})])])])])},e.staticRenderFns=[],e._scopeId="data-v-0a80b68a"},{"vueify/lib/insert-css":1}],13:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default={title:"Geoprocessing",inputs:{prjvectorlayerfeature:{selected_features:"Only selected features"},fieldchooser:{validate:{message:{multiple:"Select at least a field",single:"Select at least a field"}}}},outputs:{outputvector:{open_file_on_map:"Open output file after running algorithm"}},run:{messages:{success:"Model run successfully",error:"An Error occur on model"}},draw_types:{Polygon:"Polygon",LineString:"Line",Point:"Point"},draw_filename:"Draw layer"}},{}],14:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default={title:"Geoprocessing",inputs:{prjvectorlayerfeature:{selected_features:"Only selected features"},fieldchooser:{validate:{message:{multiple:"Select at least a field",single:"Select at least a field"}}}},outputs:{outputvector:{open_file_on_map:"Open output file after running algorithm"}},run:{messages:{success:"Model run successfully",error:"An Error occur on model"}},draw_types:{Polygon:"Polygon",LineString:"Line",Point:"Point"},draw_filename:"Draw layer"}},{}],15:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default={title:"Geoprocessing",inputs:{prjvectorlayerfeature:{selected_features:"Only selected features"},fieldchooser:{validate:{message:{multiple:"Seleziona almeno un campo",single:"Seleziona un campo"}}}},outputs:{outputvector:{open_file_on_map:"Open output file after running algorithm"}},run:{messages:{success:"Model run successfully",error:"An Error occur on model"}},draw_types:{Polygon:"Polygon",LineString:"Line",Point:"Point"},draw_filename:"Draw layer"}},{}],16:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default={title:"Geoprocessing",inputs:{prjvectorlayerfeature:{selected_features:"Only selected features"},fieldchooser:{validate:{message:{multiple:"Select at least a field",single:"Select at least a field"}}}},outputs:{outputvector:{open_file_on_map:"Open output file after running algorithm"}},run:{messages:{success:"Model run successfully",error:"An Error occur on model"}},draw_types:{Polygon:"Polygon",LineString:"Line",Point:"Point"},draw_filename:"Draw layer"}},{}],17:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var a=u(e("./it")),r=u(e("./en")),n=u(e("./fi")),i=u(e("./se")),o=u(e("./fr")),l=u(e("./de")),e=u(e("./ro"));function u(e){return e&&e.__esModule?e:{default:e}}s.default={it:a.default,en:r.default,fi:n.default,se:i.default,fr:o.default,de:l.default,ro:e.default}},{"./de":13,"./en":14,"./fi":15,"./fr":16,"./it":18,"./ro":19,"./se":20}],18:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default={title:"Geoprocessing",inputs:{prjvectorlayerfeature:{selected_features:"Solo features selezionate"},fieldchooser:{validate:{message:{multiple:"Seleziona almeno un campo",single:"Seleziona un campo"}}}},outputs:{outputvector:{open_file_on_map:"Apri il file sulla mappa"}},run:{messages:{success:"Modello eseguito con successo",error:"Errore durante l'esecuzione del modello"}},draw_types:{Polygon:"Poligono",LineString:"Linea",Point:"Punto"},draw_filename:"Layer disegnato"}},{}],19:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default={title:"Geoprocessing",inputs:{prjvectorlayerfeature:{selected_features:"Only selected features"},fieldchooser:{validate:{message:{multiple:"Select at least a field",single:"Select at least a field"}}}},outputs:{outputvector:{open_file_on_map:"Open output file after running algorithm"}},run:{messages:{success:"Model run successfully",error:"An Error occur on model"}},draw_types:{Polygon:"Polygon",LineString:"Line",Point:"Point"},draw_filename:"Draw layer"}},{}],20:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default={title:"Geoprocessing",inputs:{prjvectorlayerfeature:{selected_features:"Only selected features"},fieldchooser:{validate:{message:{multiple:"Select at least a field",single:"Select at least a field"}}}},outputs:{outputvector:{open_file_on_map:"Open output file after running algorithm"}},run:{messages:{success:"Model run successfully",error:"An Error occur on model"}},draw_types:{Polygon:"Polygon",LineString:"Line",Point:"Point"},draw_filename:"Draw layer"}},{}],21:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var a=e("../package.json"),e=e("./i18n"),e=(e=e)&&e.__esModule?e:{default:e};s.default={i18n:e.default,name:a.name}},{"../package.json":27,"./i18n":17}],22:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s,a=arguments[t];for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},r=i(e("../components/InputPrjVectorLayer.vue")),n=i(e("../components/InputPrjRasterLayer.vue")),e=i(e("../components/InputFieldChooser.vue"));function i(e){return e&&e.__esModule?e:{default:e}}s.default=a({},g3wsdk.gui.vue.Inputs.InputsComponents,{prjvectorlayer_input:r.default,prjrasterlayer_input:n.default,prjvectorlayerfeature_input:r.default,fieldchooser_input:e.default})},{"../components/InputFieldChooser.vue":3,"../components/InputPrjRasterLayer.vue":4,"../components/InputPrjVectorLayer.vue":5}],23:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var a=n(e("../components/OutputVectorLayer.vue")),r=n(e("../components/OutputRasterLayer.vue")),e=n(e("../components/OutputFile.vue"));function n(e){return e&&e.__esModule?e:{default:e}}s.default={outputvectorlayer:a.default,outputrasterlayer:r.default,outputfile:e.default,outputhtml:e.default}},{"../components/OutputFile.vue":8,"../components/OutputRasterLayer.vue":9,"../components/OutputVectorLayer.vue":10}],24:[function(e,t,s){var a=i(e("./config")),r=i(e("./service")),n=i(e("./components/Sidebar.vue"));function i(e){return e&&e.__esModule?e:{default:e}}function o(){var e=this,t=a.default.name,s=a.default.i18n;l(this,{name:t,i18n:s,service:r.default}),this.registerPlugin(this.config.gid)&&(this.setHookLoading({loading:!0}),this.service.once("ready",function(){c.isReady().then(function(){return e.setupGui()}),e.setHookLoading({loading:!1}),e.setReady(!0)}),this.service.init(this.config)),this.setupGui=function(){this.createSideBarComponent(n.default,{id:a.default.name,title:"plugins."+a.default.name+".title",collapsible:!0,open:!1,isolate:!1,iconConfig:{color:"green",icon:"tools"},mobile:!0,events:{open:{when:"before",cb:function(){}}},sidebarOptions:{position:1}})}}var e=g3wsdk.core.utils,l=e.base,e=e.inherit,u=g3wsdk.core.plugin.Plugin,c=g3wsdk.gui.GUI;e(o,u),new o},{"./components/Sidebar.vue":11,"./config":21,"./service":28}],25:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var a=n(e("./config")),r=n(e("./components/ModelPanel.vue"));function n(e){return e&&e.__esModule?e:{default:e}}var e=g3wsdk.core.utils,i=e.base;function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i(this,{id:a.default.name+"-panel",title:"plugins."+a.default.name+".title"});e=new(Vue.extend(r.default))({propsData:{model:e.model}});this.setInternalPanel(e)}(0,e.inherit)(o,g3wsdk.gui.Panel),s.default=o},{"./components/ModelPanel.vue":6,"./config":21}],26:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var a=n(e("./config")),r=n(e("./components/ModelResults.vue"));function n(e){return e&&e.__esModule?e:{default:e}}var e=g3wsdk.core.utils,i=e.base;function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i(this,{id:a.default.name+"-panel-results",title:""+e.model.display_name.toUpperCase()});e=new(Vue.extend(r.default))({propsData:{model:e.model}});this.setInternalPanel(e)}(0,e.inherit)(o,g3wsdk.gui.Panel),s.default=o},{"./components/ModelResults.vue":7,"./config":21}],27:[function(e,t,s){t.exports={name:"qprocessing",version:"3.8.0-alpha.0",description:"",main:"index.js",directories:{test:"test"},dependencies:{},devDependencies:{},scripts:{},repository:{type:"git",url:"git+https://github.com/g3w-suite/g3w-client-plugin-processing.git"},keywords:["geoprocessing","processing","qprocessing","G3W-SUITE","QGIS","plugin"],author:"",license:"ISC",bugs:{url:"https://github.com/g3w-suite/g3w-client-plugin-processing/issues"},homepage:"https://github.com/g3w-suite/g3w-client-plugin-processing/#readme",browserslist:"defaults",engines:{node:">=16.13.2",npm:">=8.1.2"}}},{}],28:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var s=t,a=[],r=!0,t=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done)&&(a.push(i.value),!s||a.length!==s);r=!0);}catch(e){t=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(t)throw n}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s,a=arguments[t];for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};function r(e){return function(){var o=e.apply(this,arguments);return new Promise(function(n,i){return function t(e,s){try{var a=o[e](s),r=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});n(r)}("next")})}}var n=g3wsdk.core,i=n.utils,o=i.base,l=i.inherit,v=i.XHR,u=n.geoutils.isSameBaseGeometryType,i=n.plugin.PluginService,c=g3wsdk.core.project.ProjectsRegistry,m=g3wsdk.core.task.TaskService,h=g3wsdk.gui.GUI;function d(){o(this);var t,s,e=this;this.prefixCustomLayer={file:"file",external:"__g3w__external__"},this.init=function(){this.config=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.mapService=h.getService("map"),this.project=c.getCurrentProject(),this.layerFields={},this.transpilModelInputsAsEditingFormInputs(),this.emit("ready",!0)},this.transpilModelInputsAsEditingFormInputs=function(){this.config.models.forEach(function(e){e.inputs.forEach(function(e){e.visible=!0,e.validate=a({empty:!0,message:null,required:!0,unique:!1,valid:!1,_valid:!1},e.validate),e.get_default_value=!0})})},this.getFieldsFromLayer=(t=r(function*(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===this.layerFields[t]&&(this.layerFields[t]={}),void 0===this.layerFields[t][JSON.stringify(e)])if(void 0===this.project.getLayers().find(function(e){return e.id===t}))this.layerFields[t][JSON.stringify(e)]=[];else try{var s=yield v.get({url:""+this.config.urls.fields+this.project.getId()+"/"+t+"/",params:e});!0===s.result&&(this.layerFields[t][JSON.stringify(e)]=s.fields)}catch(e){return[]}return this.layerFields[t][JSON.stringify(e)]}),function(e){return t.apply(this,arguments)}),this.emitChangeSelectedFeatures=function(){e.emit("change-selected-features")},this.getLayerSelectedFeaturesIds=function(t){return this.mapService.defaultsLayers.selectionLayer.getSource().getFeatures().filter(function(e){return e.__layerId===t}).map(function(e){return e.getId()})},this.registersSelectedFeatureLayersEvent=function(){this.mapService.defaultsLayers.selectionLayer.getSource().on("addfeature",e.emitChangeSelectedFeatures),this.mapService.defaultsLayers.selectionLayer.getSource().on("removefeature",e.emitChangeSelectedFeatures)},this.unregistersSelectedFeatureLayersEvent=function(){this.mapService.defaultsLayers.selectionLayer.getSource().un("addfeature",e.emitChangeSelectedFeatures),this.mapService.defaultsLayers.selectionLayer.getSource().un("removefeature",e.emitChangeSelectedFeatures)},this.registerAddExternalLayer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,s=void 0===t?"vector":t,a=e.handler;return h.getService("catalog").onafter("addExternalLayer",function(e){var t=e.type,e=e.layer;s===t&&a(e)})},this.unregisterAddExternalLayer=function(e){h.getService("catalog").un("addExternalLayer",e)},this.fromInputDatatypesToOLGeometryTypes=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return-1!==["point","line","polygon"].indexOf(e)}).map(function(e){switch(e){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon"}})},this.externalVectorLayerToInputPrjVectorLayerValue=function(e){return{key:e.name,value:this.prefixCustomLayer.external+":"+e.id}},this.isExternalLayerValidForInputDatatypes=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,e=e.datatypes,e=void 0===e?[]:e;return void 0!==e.find(function(e){return"anygeometry"===e})||void 0!==this.fromInputDatatypesToOLGeometryTypes(e).find(function(e){return u(e,t.geometryType)})},this.getInputPrjVectorLayerData=function(){var t=this,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=[],r=void 0!==s.find(function(e){return"anygeometry"===e}),n=void 0!==s.find(function(e){return"nogeometry"===e}),i=this.fromInputDatatypesToOLGeometryTypes(s);return this.project.getLayers().filter(function(e){return!e.baselayer}).forEach(function(t){var e=t.name,s=t.id;(!0==n&&(void 0===t.geometrytype||"NoGeometry"===t.geometrytype)||null!==t.geometrytype&&void 0!==t.geometrytype&&"NoGeometry"!==t.geometrytype&&(!0==r||0<i.length&&void 0!==i.find(function(e){return u(e,t.geometrytype)})))&&a.push({key:e,value:s})}),(r||0<i.length)&&h.getService("catalog").getExternalLayers({type:"vector"}).forEach(function(e){t.isExternalLayerValidForInputDatatypes({layer:e,datatypes:s})&&a.push(t.externalVectorLayerToInputPrjVectorLayerValue(e))}),a},this.getInputPrjRasterLayerData=function(){return this.project.getLayers().filter(function(e){return!e.baselayer&&void 0!==e.source&&"gdal"===e.source.type}).map(function(e){return{key:e.name,value:e.id}})},this.createGeoJSONFileFromOLFeatures=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.features,t=void 0===t?[]:t,s=e.name,e=e.crs,t=(new ol.format.GeoJSON).writeFeaturesObject(t);return t.crs={type:"name",properties:{name:e||this.mapService.getCrs()}},new File([JSON.stringify(t)],s+".geojson",{type:"application/geo+json"})},this._handleCompleteModelResponse=function(e,t){var s=t.resolve,t=t.reject,a=e.result,r=e.task_result,e=e.data;null===(r=e?e:r)||!1===a?t({}):s({result:a,task_result:r})},this._handleErrorModelResponse=function(e,t){var t=t.reject,s=e.status,a=e.exception,r=!1,n=!1,i=void 0;switch(s){case"500":case 500:i=e.responseJSON?e.responseJSON.exception||e.responseJSON.error.message:"server_error",n=void 0!==a,r=!0;break;case"error":i=a,r=n=!0}return r&&(h.showUserMessage({type:"alert",message:i,textMessage:n}),t({statusError:!0,timeout:!1})),r},this.runModel=function(){var s,c=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},d=e.model,p=e.state;return new Promise((s=r(function*(r,n){var i=void 0,e={},t=!0,s=!1,a=void 0;try{for(var o,l=d.inputs[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var u=o.value;u.value&&("prjvectorlayer"===u.input.type&&u.value.startsWith(c.prefixCustomLayer.external+":")&&(yield*function*(){var e=u.value.split(c.prefixCustomLayer.external+":"),t=f(e,2)[1],e=h.getService("catalog").getExternalLayers({type:"vector"}).find(function(e){return e.id===t}),s=e.crs,e=e.name,a=c.mapService.getLayerById(t),e=c.createGeoJSONFileFromOLFeatures({name:e,features:a.getSource().getFeatures(),crs:s});try{var r=(yield c.uploadFile({modelId:d.id,inputName:u.name,file:e})).value;u.value=r}catch(e){n(e)}}()),e[u.name]=u.value)}}catch(e){s=!0,a=e}finally{try{!t&&l.return&&l.return()}finally{if(s)throw a}}s={inputs:e,outputs:d.outputs.reduce(function(e,t){return t.value&&(e[t.name]=t.value),e},{})},a=""+c.config.urls.run+d.id+"/"+c.project.getId()+"/";c.config.async?m.runTask({url:a,taskUrl:c.config.urls.taskinfo,params:{data:JSON.stringify(s)},method:"POST",listener:function(e){var t=e.task_id,e=(e.timeout,e.response),s=e.progress,a=e.status;"complete"===a?(m.stopTask({task_id:t}),i=null,c._handleCompleteModelResponse(e,{resolve:r,reject:n})):"executing"===a?(null===p.progress||void 0===p.progress||s>p.progress?i=Date.now():6e5<Date.now()-i&&(m.stopTask({task_id:t}),h.showUserMessage({type:"warning",message:"Timeout",autoclose:!0}),p.progress=null,n({timeout:!(i=null)})),p.progress=s):c._handleErrorModelResponse(e,{reject:n})&&(p.progress=null,i=null,m.stopTask({task_id:t}))}}):v.post({url:a,data:JSON.stringify(s),contentType:"application/json"}).then(function(e){c._handleCompleteModelResponse(e,{resolve:r,reject:n})}).catch(function(e){e.status=500,c._handleErrorModelResponse(e,{reject:n})})}),function(e,t){return s.apply(this,arguments)}))},this.uploadFile=(s=r(function*(e){var t=e.modelId,s=e.inputName,e=e.file,a=new FormData;a.append("file",e);try{var r=yield(yield fetch(""+this.config.urls.upload+t+"/"+this.project.getId()+"/"+s+"/",{method:"POST",body:a})).json();if(r.result)return{key:e.name,value:this.prefixCustomLayer.file+":"+r.data.file}}catch(e){throw new Error(e)}}),function(e){return s.apply(this,arguments)})}l(d,i),s.default=new d},{}]},{},[24]);
//# sourceMappingURL=../g3w-client/src/plugins/qprocessing/plugin.js.map
